name: Despliegue a Producci√≥n

on:
  push:
    branches:
      - main  # Cambia a 'master' si es necesario

jobs:
  web-deploy:
    name: üöÄ Desplegar a Hosting Compartido
    runs-on: ubuntu-latest

    steps:
      # 1. Obtener el c√≥digo del repositorio
      - name: üöö Obtener c√≥digo fuente
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. Configurar Node.js
      - name: üü¢ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'  # Usar versi√≥n LTS
          cache: 'npm'

      # 3. Instalar dependencias y construir el proyecto
      - name: üî® Instalar dependencias y construir
        run: |
          npm ci
          npm run build
        env:
          NODE_ENV: production

      # 4. Desplegar v√≠a FTP
      - name: üì§ Subir archivos v√≠a FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftp
          port: 21
          local-dir: ./dist/
          server-dir: /
          exclude: |
            **/.git*
            **/.git*/*
            **/node_modules/**
            **/.github/**
            **/.gitignore
            **/.gitmodules
            **/.vscode/**
            **/*.md
            **/*.mdx
            **/tsconfig.json
            **/astro.config.*
            **/package*.json
            **/pnpm-lock.yaml
            **/yarn.lock
            **/.eslintrc*
            **/.prettierrc*
            **/README*
            **/.htaccess  # Aseg√∫rate de no sobrescribir configuraciones existentes
            **/cgi-bin/**  # Directorios especiales del servidor

      # 5. Notificaci√≥n opcional de √©xito
      - name: ‚úÖ Notificar √©xito
        if: success()
        run: |
          echo "‚úÖ Despliegue completado exitosamente!"

      # 6. Notificaci√≥n opcional de error
      - name: ‚ùå Notificar error
        if: failure()
        run: |
          echo "‚ùå Error durante el despliegue"
          exit 1
